# üîê FitTrack UA+ ‚Äî Backup & Sync Specification v3

> **–í–µ—Ä—Å–∏—è:** 3.0  
> **–î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:** 2025-11-02  
> **–ü–æ–¥—Ö–æ–¥:** Offline-First + Cloud Sync

## –û–±–∑–æ—Ä
–î–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç —Ñ–æ—Ä–º–∞—Ç –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –±—ç–∫–∞–ø–∞ `fittrack-data.json`, –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ `fittrack-data.hash`, –∞ —Ç–∞–∫–∂–µ —É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Ä–∞–±–æ—Ç—ã —Å –æ–±–ª–∞—á–Ω—ã–º–∏ –∫–æ–Ω–Ω–µ–∫—Ç–æ—Ä–∞–º–∏ (OneDrive, Google Drive, Dropbox, iCloud). –°–µ—Ä–≤–µ—Ä–Ω—ã—Ö REST API –±–æ–ª—å—à–µ –Ω–µ—Ç ‚Äî –≤—Å—è –ª–æ–≥–∏–∫–∞ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –≤ –∫–ª–∏–µ–Ω—Ç–µ, –∞ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å –æ–±–ª–∞–∫–∞–º–∏ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –Ω–∞–ø—Ä—è–º—É—é —á–µ—Ä–µ–∑ SDK –∏ OAuth.

---

## üì¶ –§–æ—Ä–º–∞—Ç –±—ç–∫–∞–ø–∞
–ü–µ—Ä–µ–¥ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç –æ–±—ä–µ–∫—Ç `BackupSnapshot`:
```json
{
  "version": 3,
  "generatedAt": "2025-11-02T09:45:12.123Z",
  "water": [ { "id": "w-173053", "amountMl": 250, "timestamp": "2025-11-02T06:00:00.000Z" } ],
  "food": [ { "id": "f-39012", "name": "–û–≤—Å—è–Ω–∫–∞", "calories": 240, "macros": { "protein": 6, "fat": 4, "carbs": 42 }, "vitamins": { "C": 12 } } ],
  "vitamins": [ { "id": "vit-01", "code": "D", "value": 5, "recommended": 10, "unit": "¬µg" } ],
  "reminders": [ { "id": "rem-01", "type": "water", "time": "09:00", "intervalMinutes": 120, "enabled": true } ],
  "settings": {
    "waterGoalMl": 2500,
    "calorieGoal": 2000,
    "theme": "system",
    "language": "uk",
    "sync": {
      "enabled": true,
      "provider": "gdrive",
      "lastUploadedAt": "2025-11-01T18:33:10.000Z"
    }
  }
}
```

### –ü—Ä–∞–≤–∏–ª–∞
- –ü–æ–ª–µ `version` —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –≤–µ—Ä—Å–∏–∏ —Å—Ö–µ–º—ã IndexedDB.
- –í—Å–µ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã ‚Äî —Å—Ç—Ä–æ–∫–æ–≤—ã–µ UUID/ulid.
- –î–∞—Ç—ã ‚Äî ISO 8601 –≤ UTC.
- –ü–µ—Ä–µ–¥ –∑–∞–ø–∏—Å—å—é –≤ —Ñ–∞–π–ª –æ–±—ä–µ–∫—Ç —Å–µ—Ä–∏–∞–ª–∏–∑—É–µ—Ç—Å—è –≤ JSON –∏ —à–∏—Ñ—Ä—É–µ—Ç—Å—è.

---

## üîê –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `AES-GCM 256`.
- IV (12 –±–∞–π—Ç) –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –±—ç–∫–∞–ø–∞ –æ—Ç–¥–µ–ª—å–Ω–æ –∏ –∫–æ–¥–∏—Ä—É–µ—Ç—Å—è –≤ base64.
- –†–µ–∑—É–ª—å—Ç–∞—Ç —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ `EncryptedBackup`:
```json
{
  "ciphertext": "base64...",
  "iv": "base64...",
  "salt": "base64...",          // –¥–ª—è PBKDF2
  "iterations": 310000,           // –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏—Ç–µ—Ä–∞—Ü–∏–π PBKDF2
  "kdf": "PBKDF2-SHA256",
  "authTag": "base64...",        // –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å –Ω–∞—Ç–∏–≤–Ω—ã–º–∏ —Å—Ä–µ–¥–∞–º–∏
  "meta": {
    "schemaVersion": 3,
    "backupVersion": "2025.11.02-01",
    "generatedAt": "2025-11-02T09:45:12.123Z",
    "appVersion": "1.0.0"
  }
}
```

- –ü–∞—Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è –∑–∞—â–∏—Ç—ã –º–∞—Å—Ç–µ—Ä-–∫–ª—é—á–∞ (`masterKey`).
- –•—ç—à `fittrack-data.hash` —Å–æ–¥–µ—Ä–∂–∏—Ç:
```json
{
  "hash": "sha256:ab56b4d92b40713acc5af89985d4b786",
  "generatedAt": "2025-11-02T09:45:12.123Z",
  "backupVersion": "2025.11.02-01"
}
```

---

## ‚òÅÔ∏è –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –æ–±–ª–∞—á–Ω—ã—Ö –∫–æ–Ω–Ω–µ–∫—Ç–æ—Ä–æ–≤
–ö–∞–∂–¥—ã–π –∫–æ–Ω–Ω–µ–∫—Ç–æ—Ä –æ–±—è–∑–∞–Ω —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∫–æ–Ω—Ç—Ä–∞–∫—Ç:
```ts
export interface CloudConnector {
  readonly id: CloudProviderId;
  readonly displayName: string;
  authenticate(): Promise<AuthResult>;
  upload(payload: EncryptedBackup, hash: BackupHash): Promise<UploadResult>;
  download(): Promise<DownloadedBackup | null>;
  revoke(): Promise<void>;
  getStatus(): Promise<ConnectorStatus>;
}
```

### –°—Ü–µ–Ω–∞—Ä–∏–∏
1. **–ü–µ—Ä–≤–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è**
   - –í—ã–∑—ã–≤–∞–µ—Ç—Å—è `authenticate()` ‚Üí OAuth 2.0 PKCE/Device Code Flow.
   - Access token —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ IndexedDB –≤ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–º –≤–∏–¥–µ.
2. **–ó–∞–≥—Ä—É–∑–∫–∞**
   - `upload()` —Å–æ–∑–¥–∞—ë—Ç/–æ–±–Ω–æ–≤–ª—è–µ—Ç —Ñ–∞–π–ª `fittrack-data.json` –∏ —Å–æ–ø—É—Ç—Å—Ç–≤—É—é—â–∏–π `fittrack-data.hash`.
   - –î–ª—è OneDrive/GDrive –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è REST SDK, –¥–ª—è Dropbox ‚Äî `files/upload`, –¥–ª—è iCloud ‚Äî WebDAV.
3. **–ó–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ**
   - `download()` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `EncryptedBackup` –∏ –ø—Ä–æ–≤–µ—Ä–∫—É –Ω–∞–ª–∏—á–∏—è hash-—Ñ–∞–π–ª–∞.
   - –ü—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ —Ñ–∞–π–ª–æ–≤ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è `null`.
4. **–û—Ç–∑—ã–≤ –¥–æ—Å—Ç—É–ø–∞**
   - `revoke()` —É–¥–∞–ª—è–µ—Ç —Ç–æ–∫–µ–Ω—ã –∏ –ª–æ–∫–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–æ–Ω–Ω–µ–∫—Ç–æ—Ä–∞.

---

## üîÅ –°—Ç–∞—Ç—É—Å—ã —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
`ConnectorStatus` —Å–æ–¥–µ—Ä–∂–∏—Ç:
```ts
interface ConnectorStatus {
  state: 'idle' | 'auth_required' | 'uploading' | 'downloading' | 'conflict' | 'error';
  lastSyncAt?: string;
  error?: string;
  remoteVersion?: string;
  localVersion?: string;
}
```

- –ü—Ä–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–µ (`state = 'conflict'`) –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç ¬´–ó–∞–≥—Ä—É–∑–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ¬ª –∏–ª–∏ ¬´–ü–µ—Ä–µ–∑–∞–ø–∏—Å–∞—Ç—å –æ–±–ª–∞–∫–æ¬ª.
- –†–µ—à–µ–Ω–∏–µ —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç—Å—è –≤ `settings.syncResolution` –∏ –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è –≤ Sync Engine.

---

## üõ° –ü–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏
- –û–±–ª–∞—á–Ω—ã–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã –Ω–µ –ø–æ–ª—É—á–∞—é—Ç –¥–æ—Å—Ç—É–ø –∫ —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–º –¥–∞–Ω–Ω—ã–º ‚Äî –≤ –æ–±–ª–∞–∫–µ —Ö—Ä–∞–Ω–∏—Ç—Å—è —Ç–æ–ª—å–∫–æ —à–∏—Ñ—Ä—Ç–µ–∫—Å—Ç.
- –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ª–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–Ω–∏–µ —Å–µ—Ä–≤–µ—Ä—ã –±–µ–∑ —è–≤–Ω–æ–≥–æ —Å–æ–≥–ª–∞—Å–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
- –î–ª—è –æ—Ç–ª–∞–¥–∫–∏ –ø—Ä–µ–¥—É—Å–º–æ—Ç—Ä–µ–Ω —Ä–µ–∂–∏–º `diagnostic`, –≤ –∫–æ—Ç–æ—Ä–æ–º –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ (–±–µ–∑ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ). –û–Ω –æ—Ç–∫–ª—é—á—ë–Ω –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.

---

## ‚úÖ –ß–µ–∫-–ª–∏—Å—Ç —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞
- [ ] –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–π –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç—å `version` –∏ `backupVersion` –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö —Å—Ö–µ–º—ã.
- [ ] –û–±–Ω–æ–≤–ª—è–π —Å–ø–∏—Å–æ–∫ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã—Ö –∫–æ–Ω–Ω–µ–∫—Ç–æ—Ä–æ–≤ –∏ –∏—Ö –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ OAuth.
- [ ] –ü–∏—à–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –¥–ª—è `upload`/`download` —á–µ—Ä–µ–∑ –º–æ–∫-—Å–µ—Ä–≤–∏—Å—ã.
- [ ] –û–±–Ω–æ–≤–ª—è–π UI-–ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–æ–≤ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏.

---

_FitTrack UA+ Backup & Sync v3 ¬∑ –û–±–Ω–æ–≤–ª–µ–Ω–æ 2 –Ω–æ—è–±—Ä—è 2025 –≥–æ–¥–∞_
